## Prometheus простыми словами.

В двух словах, Prometheus — система мониторинга, обладающая возможностями тонкой настройки метрик. Она будет полезна для отслеживания состояния работы сервисов на низком уровне.

Основные преимущества — предоставление возможности создания гибких запросов к данным и хранение значений метрик в базе данных временных рядов,   
возможность автоматизации при администрировании. Разработана фондом облачных вычислений (Cloud Native Computing Foundation или CNCF).

Для получения метрик с удаленных узлов используется метод pull (сервер сам забирает данные). 

На узлы для сбора информации устанавливаются экспортеры (exporter) — пакеты, получающие данные для операционной системы или конкретного сервиса.

Также метрики могут собираться с помощью механизма push — для этого используется компонент pushgateway, который должен быть установлен дополнительно.

Довольно часто Prometheus настраивают в связке с Grafana, которая позволяет визуализировать показания наших метрик.   
В графане для этого есть уже настроенный источник, таким образом, настройка выполняется из коробки.

В сравнении с другими системами мониторинга обладает рядом отличий, например, в сравнении с Zabbix:

 - Zabbix является полностью законченной системой, которая предоставляет веб-инструмент для настройки и визуализации (dashboard).    
Prometheus — это всего лишь база данных со значениями для метрик. Для настройки и визуализации используются средства, которые являются сторонними или разработанными самостоятельно.  
 - Установка Prometheus не может быть выполнена из репозитория простыми командами. Нам необходимо скачать бинарник, а также создать скрипт для автозапуска или юнит в systemd. Также возможно установка из неофициального образа Docker.
 - Для отправки уведомлений Zabbix использует штатные средства. Для Prometheus устанавливается и настраивается Alertmanager.
 - Zabbix наполнен дополнительными инструментами, такими как графики, построение логической сети, автообнаружение и так далее. Prometheus этим не богат и для дополнительных возможностей необходима установка плагинов или доработка собственных модулей.

Prometheus является приложением от программистов для программистов. Prometheus более популярен для мониторинга сервисов в среде DevOps, например, Kubernetes. Zabbix же плохо подходит для динамических систем (например, в последнем могут постоянно удаляться и создаваться новые поды с сервисами) и уступает в этом плане прометею.



## Установка Prometheus + Alertmanager + node_exporter на Linux

### Подготовка сервера

### Время

#### Для отображения событий в правильное время, необходимо настроить его синхронизацию. Для этого установим chrony:
```
# CentOS / Red Hat:
yum -y install chrony
systemctl enable chronyd
systemctl start chronyd

# Ubuntu / Debian:
apt-get install chrony
systemctl enable chrony
systemctl start chrony
```

#### Брандмауэр
#### На фаерволе, при его использовании, необходимо открыть порты: 
 - TCP 9090 — http для сервера prometheus.
 - TCP 9093 — http для алерт менеджера.
 - TCP и UDP 9094 — для алерт менеджера.
 - TCP 9100 — для node_exporter.

```
# с помощью firewalld:
firewall-cmd --permanent --add-port=9090/tcp --add-port=9093/tcp --add-port=9094/{tcp,udp} --add-port=9100/tcp
firewall-cmd --reload

# с помощью iptables:
iptables -I INPUT 1 -p tcp --match multiport --dports 9090,9093,9094,9100 -j ACCEPT
iptables -A INPUT -p udp --dport 9094 -j ACCEPT

# с помощью ufw:
ufw allow 9090,9093,9094,9100/tcp
ufw allow 9094/udp
ufw reload
```
























